(this["webpackJsonpubongo-solver"]=this["webpackJsonpubongo-solver"]||[]).push([[0],{16:function(e,t,n){e.exports=n(25)},21:function(e,t,n){},22:function(e,t,n){},25:function(e,t,n){"use strict";n.r(t);var r=n(3),a=n.n(r),o=n(11),i=n.n(o),c=(n(21),n(15)),s=n(4),l=n(12),u=n(6),d=n(5),h=n(7),f=(n(22),n(0)),p=n(2),m=n.n(p),v=n(13),y=n.n(v)()(f),w=[6853313,15843656,15358028,8234050],b=[{color:15358028,pieces:[[[2,0],[1,1]],[[1,1],[0,1],[0,2]],[[1,1],[1,2]],[[1,1,0],[0,1,1]]]},{color:15843656,pieces:[[[2,1],[0,1]],[[1,1],[1,0],[1,1]],[[0,1,0],[2,1,1]],[[1,1],[1,0],[2,0]]]},{color:8234050,pieces:[[[1,1,1],[1,0,0]],[[1,1,1],[0,1,0]],[[2,0,0],[1,1,1]],[[0,1,1],[2,1,0]]]},{color:6853313,pieces:[[[1,1],[0,1]],[[1,1,1],[2,0,0]],[[0,1,1],[1,1,1]],[[2,1,0],[0,1,1]]]}];var g=n(9);var x=n(14),E=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){new I}},{key:"render",value:function(){return a.a.createElement("div",{id:"overlay-container"},a.a.createElement("div",{id:"text-container"}),a.a.createElement("div",{id:"button"}))}}]),t}(a.a.Component),k=new f.MeshBasicMaterial({color:16777215}),G=new f.LineBasicMaterial({color:16777215}),S=new f.Geometry;S.vertices.push(new f.Vector3(0,0,0)),S.vertices.push(new f.Vector3(.1,0,0)),S.vertices.push(new f.Vector3(.1,.1,0)),S.vertices.push(new f.Vector3(0,.1,0)),S.vertices.push(new f.Vector3(0,0,0));var M=new f.BoxGeometry(.1,.1,.001),B=function(e){e.computeBoundingBox();var t=new f.Vector3;return e.boundingBox.getSize(t),m()(b).flatMap((function(e){return e.pieces.map((function(t){return{packedGeo:t,color:e.color}}))})).map((function(n){var r=n.packedGeo,a=n.color,o=new f.MeshStandardMaterial({color:a,roughness:.9}),i=null;r.forEach((function(n,r){n.forEach((function(n,a){for(var o=0;o<n;o++){var c=e.clone();c.translate(a*t.x,r*t.y,o*t.z);var s=new f.Mesh(c);i=i?i.union(new y(s)):new y(s)}}))}));var c=i.toMesh();return c.material=o,c.receiveShadow=!0,c.castShadow=!0,c.userData.originalPiece=r,c})).value()}(new f.BoxGeometry(.1,.1,.1)),I=function e(){var t=this;Object(s.a)(this,e),this.overlayContainer=document.getElementById("overlay-container"),this.camera=new f.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.01,100),this.scene=new f.Scene,this.renderer=new f.WebGLRenderer({antialias:!0}),this.state=1,this.raycaster=new f.Raycaster,this.mouse=new f.Vector2,this.lastHoverTarget=null,this.buttonCallback=function(){},this.boardGroup=new f.Group,this.selectedBoard=[],this.selectPiecesGroup=new f.Group,this.solveResult=[],this.solvePiecesGroup=new f.Group,this.controls=null,this.renderFrame=function(){if(1===t.state)t.selectBoard();else if(2===t.state){var e=0;t.boardGroup.children.forEach((function(t){t.material.opacity=Math.max(t.material.opacity-.025,0),t.material.opacity>e&&(e=t.material.opacity)})),0===e&&(t.state=3,t.camera.updateMatrixWorld(),B.forEach((function(e,n){var r=n%6,a=Math.floor(n/6),o=e.clone();o.translateX(.5*(-2.8+r)),o.translateY(.6-.65*a),o.translateZ(-1),o.receiveShadow=!0,o.castShadow=!0,o.material.transparent=!0,o.pieceIndex=n,t.selectPiecesGroup.add(o);var i=document.createElement("input");i.type="number",i.value="0",i.min="0",t.overlayContainer.appendChild(i);var c=window.innerWidth/2,s=window.innerHeight/2,l=o.position.clone();l.y-=.2,l.project(t.camera),i.style.opacity="1",i.dataset.pieceJson=JSON.stringify(o.userData.originalPiece),i.dataset.originalIndex=n.toString(),i.style.left="".concat(Math.round(l.x*c+c),"px"),i.style.top="".concat(Math.round(-l.y*s+s),"px")})),t.scene.add(t.selectPiecesGroup)),t.scheduleFrame()}else if(3===t.state)t.selectPieces();else if(4===t.state){var n=0;if(document.querySelectorAll("input").forEach((function(e){var t=Number(e.style.opacity),r=Math.max(t-.025,0);e.style.opacity=r.toString(),n=Math.max(r,n)})),t.selectPiecesGroup.children.forEach((function(e,t){e.material.opacity=Math.max(e.material.opacity-.025,0),n=Math.max(e.material.opacity,n)})),0===n)t.scene.remove(t.selectPiecesGroup),Array.from(document.querySelectorAll("input")).forEach((function(e){var t;null===(t=e.parentElement)||void 0===t||t.removeChild(e)})),t.boardGroup.children.filter((function(e){return!(e instanceof f.Line)||!t.selectedBoard[e.yIndex][e.xIndex]})).forEach((function(e){t.boardGroup.remove(e)})),t.boardGroup.translateZ(-.6),t.state=5;t.scheduleFrame()}else if(5===t.state){var r=0,a=1;t.solvePiecesGroup.children.forEach((function(e,t){var n=P(t);n.sub(e.position),n.clampLength(0,.01),n.length()>r&&(r=n.length()),e.position.add(n),e.rotateX(.005),e.rotateY(.0025)})),t.boardGroup.children.forEach((function(e){e.material.opacity=Math.min(e.material.opacity+.025,1),e.material.opacity<a&&(a=e.material.minOpacity)})),r<=.001&&1===a&&(t.controls=new x.a(t.camera,document.getElementsByTagName("body")[0]),t.controls.target=new f.Vector3(0,0,-.6),t.state=6),t.scheduleFrame()}else if(6===t.state){var o;t.setText("3/3: Raahaa hiirt\xe4 liikuttaaksesi kameraa ja rullaa hiirt\xe4 zoomataksesi"),null===(o=t.controls)||void 0===o||o.update();var i=!1,c=0;t.solvePiecesGroup.children.forEach((function(e,n){if(i){e.rotation.x+=.005,e.rotation.y+=.0025;var r=P(n-c);r.sub(e.position),r.clampLength(0,.01),r.length()>1e-4&&e.position.add(r)}else{c+=1;var a=t.solveResult[n];if(0===e.userData.finalState){e.rotation.x+=.005,e.rotation.y+=.0025;var o=V(a);o.z+=.4,o.sub(e.position),o.clampLength(0,.01),o.length()>1e-4?(e.position.add(o),i=!0):e.userData.finalState=1}if(1===e.userData.finalState){var s=function(e){var t=new f.Object3D;return e.forEach((function(e){"x"===e?t.rotateOnWorldAxis(new f.Vector3(1,0,0),2*Math.PI*.25):"y"===e?t.rotateOnWorldAxis(new f.Vector3(0,1,0),2*Math.PI*.25):t.rotateOnWorldAxis(new f.Vector3(0,0,1),2*Math.PI*.25)})),t.rotation}(a.rotations).toVector3(),l=e.rotation.toVector3();s.sub(l),s.clampLength(0,.05),s.length()>1e-6?(l.add(s),e.rotation.setFromVector3(l),i=!0):e.userData.finalState=2}if(2===e.userData.finalState){var u=V(a);u.sub(e.position),u.clampLength(0,.01),u.length()>1e-4?(e.position.add(u),i=!0):e.userData.finalState=3}}})),i&&t.scheduleFrame()}t.renderer.render(t.scene,t.camera)},this.selectBoard=function(){t.setText("1/3: Piirr\xe4 pelilauta"),t.setButton("Jatka",(function(){t.setButton(null,(function(){})),t.state=2,t.selectedBoard=m()(t.boardGroup.children).filter((function(e){return e.isRayCastTarget})).groupBy((function(e){return e.position.y})).values().sortBy((function(e){return e[0].position.y})).map((function(e){return m.a.sortBy(e,(function(e){return e.position.x})).map((function(e){return.8===e.material.opacity}))})).value(),t.scheduleFrame()})),t.raycaster.setFromCamera(t.mouse,t.camera);var e=t.raycaster.intersectObjects(t.boardGroup.children);t.boardGroup.children.forEach((function(e){e.isRayCastTarget&&.25===e.material.opacity&&(e.material.opacity=0)})),t.lastHoverTarget=null;var n=!0,r=!1,a=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var c=o.value.object;if(c.isRayCastTarget){.8!==c.material.opacity&&(c.material.opacity=.25),t.lastHoverTarget=c;break}}}catch(s){r=!0,a=s}finally{try{n||null==i.return||i.return()}finally{if(r)throw a}}},this.selectPieces=function(){t.setText("2/3: Valitse palat"),t.setButton("Ratkaise lauta",(function(){t.setButton(null,(function(){}));var e=m()(document.querySelectorAll("input")).flatMap((function(e){return m.a.times(parseInt(e.value,10),m.a.constant([JSON.parse(e.dataset.pieceJson||""),parseInt(e.dataset.originalIndex||"",10)]))})).value(),n=m.a.flatten(t.selectedBoard.map((function(e){return e.map((function(e){return e?1:0}))})));console.log("-------flatboard"),console.log(n);var r=e.map((function(e){var t=Object(c.a)(e,2);return function(e,t){var n=[];return e.forEach((function(e,t){e.forEach((function(e,r){for(var a=0;a<e;a++)n.push([r,t,a])}))})),console.log("-------"),console.log(e),console.log("---\x3e"),console.log(n),{blocks:n,originalIndex:t,rotations:[],dX:0,dY:0,dZ:0}}(t[0],t[1])}));if(2*n.filter((function(e){return e})).length===m()(r).map((function(e){return e.blocks})).flatten().value().length){var a=function(e,t,n,r){if(e*t!==n.length)throw new Error("invalid board/width/heigh");var a=performance.now(),o=2;function i(e,t,n){return Object(g.a)({},e,{blocks:e.blocks.map(n),originalIndex:e.originalIndex,rotations:e.rotations.concat(t)})}function c(e){return i(e,"x",(function(e){return[e[0],-e[2],e[1]]}))}function s(e){return i(e,"y",(function(e){return[e[2],e[1],-e[0]]}))}function l(e){return i(e,"z",(function(e){return[-e[1],e[0],e[2]]}))}function u(e){var t=Number.MAX_VALUE,n=Number.MAX_VALUE,r=Number.MAX_VALUE;e.blocks.forEach((function(e){e[0]<t&&(t=e[0]),e[1]<n&&(n=e[1]),e[2]<r&&(r=e[2])}));var a=Object(g.a)({},e,{blocks:e.blocks.map((function(e){return[e[0]-t,e[1]-n,e[2]-r]})),dX:e.dX-t,dY:e.dY-n,dZ:e.dZ-r});return a.blocks.sort((function(e,t){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return 0!==n?n:0!==r?r:0!==a?a:0})),a}function d(e,t){for(var n=0;n<t.length;n++){for(var r=!0,a=0;a<t[n].blocks.length;a++){var o=e.blocks[a],i=t[n].blocks[a];r=r&&o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]}if(r)return}t.push(e)}n=n.concat(n);var h=function(e){for(var t=[],n=0;n<e.length;n++){for(var r=[],a=e[n],o=0;o<4;o++){for(var i=0;i<4;i++){for(var h=0;h<4;h++)d(u(a),r),a=s(a);a=l(a)}a=c(a)}t.push(r)}return t}(r);function f(r,a,i){return!(r<0||r>=e||a<0||a>=t||i<0||i>=o)&&1===n[i*e*t+a*e+r]}function p(r,a,i,c){if(r<0||r>=e||a<0||a>=t||i<0||i>=o)throw new Error("out of bounds! "+r+", "+a+", "+i);n[i*e*t+a*e+r]=+c}function v(e,t,n,r){for(var a=0;a<r.blocks.length;a++){var o=r.blocks[a];if(!f(o[0]+e,o[1]+t,o[2]+n))return!1}return!0}function y(e,t,n,r){r.blocks.forEach((function(r){p(r[0]+e,r[1]+t,r[2]+n,0)}))}function w(e,t,n,r){r.blocks.forEach((function(r){p(r[0]+e,r[1]+t,r[2]+n,1)}))}var b=[],x=function n(r){if(0===r.length)return console.log("Solved the board!"),m.a.cloneDeep(b);for(var a=0;a<e;a++)for(var i=0;i<t;i++)for(var c=0;c<o;c++)for(var s=0;s<r[0].length;s++){var l=r[0][s];if(v(a,i,c,l)){y(a,i,c,l),b.push([a+l.dX,i+l.dY,c+l.dZ,l]);var u=n(r.slice(1));if(b.pop(),w(a,i,c,l),u)return u}}return null}(h),E=null;return x&&(E=m.a.sortBy(x,(function(e){var t=e[2]-e[3].dZ;return m.a.sum(e[3].blocks.map((function(e){return t+e[2]})))/e[3].blocks.length})).map((function(e){return{x:e[0],y:e[1],z:e[2],rotations:e[3].rotations,originalIndex:e[3].originalIndex}}))),console.log("solver ran in "+(performance.now()-a)+"ms"),E}(5,5,n,r);a?(console.log(a),a.forEach((function(e,n){var r=t.selectPiecesGroup.children.find((function(t){return t.pieceIndex===e.originalIndex})).clone();r.material=r.material.clone(),r.material.color.setHex(w[n%w.length]),r.userData.finalState=0,t.solvePiecesGroup.add(r)})),t.scene.add(t.solvePiecesGroup),t.solveResult=a,t.state=4,t.setText(""),t.scheduleFrame()):alert("unable to solve, please check the pieces")}else alert("Please select correct pieces or confirm that the board is correct")})),t.selectPiecesGroup.children.forEach((function(e){e.lookAt(e.position.x-t.mouse.x,e.position.y-t.mouse.y,1),e.rotation.z=0}))},this.hasScheduled=!1,this.scheduleFrame=function(){t.hasScheduled||(t.hasScheduled=!0,requestAnimationFrame(t.scheduled))},this.scheduled=function(){t.hasScheduled=!1,t.renderFrame()},this.lastText=null,this.setText=function(e){e!==t.lastText&&(t.lastText=e,document.getElementById("text-container").innerText=e)},this.setButton=function(e,n){var r=document.getElementById("button");e?(r.innerText=e,r.style.visibility="visible",t.buttonCallback=n):r.style.visibility="hidden"},this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=f.PCFSoftShadowMap,this.camera.position.z=1,this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),document.getElementById("button").addEventListener("click",(function(){t.buttonCallback()})),window.document.addEventListener("mousewheel",(function(e){t.scheduleFrame()}),{capture:!0}),window.document.addEventListener("mousemove",(function(e){t.mouse.x=e.clientX/window.innerWidth*2-1,t.mouse.y=-e.clientY/window.innerHeight*2+1,t.scheduleFrame()})),window.document.addEventListener("click",(function(){var e=t.lastHoverTarget;e&&(e.material.opacity=.8===e.material.opacity?.25:.8,t.scheduleFrame())}));for(var n=0;n<5;n+=1)for(var r=0;r<5;r+=1){var a=.1*n-.2,o=.1*r-.2,i=new f.Line(S.clone(),G.clone());i.position.x=a,i.position.y=o,i.xIndex=n,i.yIndex=r,i.material.transparent=!0,this.boardGroup.add(i);var l=new f.Mesh(M,k.clone());l.position.x=a+.05,l.position.y=o+.05,l.material.opacity=0,l.material.transparent=!0,l.isRayCastTarget=!0,this.boardGroup.add(l)}this.scene.add(this.boardGroup);var u=new f.PointLight(16777215,1,0,1);u.position.set(0,0,.3),u.castShadow=!0,u.shadow.mapSize.width=1024,u.shadow.mapSize.height=1024,u.shadow.bias=1e-11,u.shadow.camera.near=.01,u.shadow.radius=3,this.scene.add(u);var d=new f.AmbientLight;d.intensity=.5,this.scene.add(d),this.renderFrame()};function P(e){return new f.Vector3(-1,-.6*e,-.4)}function V(e){return new f.Vector3(.1*e.x-.15,.1*e.y-.15,.1*e.z+.05-.6)}var T=E;i.a.render(a.a.createElement(T,null),document.getElementById("root"))}},[[16,1,2]]]);
//# sourceMappingURL=main.27bd52dd.chunk.js.map