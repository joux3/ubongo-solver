(this["webpackJsonpubongo-solver"]=this["webpackJsonpubongo-solver"]||[]).push([[0],{14:function(e,t,n){e.exports=n(23)},19:function(e,t,n){},20:function(e,t,n){},23:function(e,t,n){"use strict";n.r(t);var r=n(3),o=n.n(r),a=n(11),i=n.n(a),c=(n(19),n(4)),s=n(12),l=n(6),u=n(5),d=n(7),h=(n(20),n(0)),f=n(2),p=n.n(f),m=[[[1,1],[0,1]],[[2,0],[1,1]],[[2,1],[0,1]],[[1,1],[1,0],[1,1]],[[0,1,0],[2,1,1]],[[1,1,1],[0,1,0]],[[1,1],[0,1],[0,2]],[[1,1],[0,2],[0,1]],[[1,1,1],[2,0,0]],[[1,1,1],[1,0,0]],[[0,1,1],[1,1,1]],[[1,1],[1,2]],[[1,1,0],[0,1,1]],[[2,1,0],[0,1,1]]],v=[3749723,7625879,13998030,16101579];var y=n(9);var w=n(13),b=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){new B}},{key:"render",value:function(){return o.a.createElement("div",{id:"overlay-container"},o.a.createElement("div",{id:"text-container"}),o.a.createElement("div",{id:"button"}))}}]),t}(o.a.Component),g=new h.j({color:16777215}),x=new h.g({color:16777215}),E=new h.d;E.vertices.push(new h.v(0,0,0)),E.vertices.push(new h.v(.1,0,0)),E.vertices.push(new h.v(.1,.1,0)),E.vertices.push(new h.v(0,.1,0)),E.vertices.push(new h.v(0,0,0));var k=new h.b(.1,.1,.001),S=function(e){e.computeBoundingBox();var t=new h.v;return e.boundingBox.getSize(t),m.map((function(n,r){var o=new h.k({color:v[r%v.length],roughness:.9}),a=new h.d;n.forEach((function(n,r){n.forEach((function(n,o){for(var i=0;i<n;i++){var c=e.clone();c.translate(o*t.x,r*t.y,i*t.z),a.mergeMesh(new h.i(c)),a.mergeVertices()}}))})),a.mergeVertices();var i=new h.i(a,o);return i.receiveShadow=!0,i.castShadow=!0,i}))}(new h.b(.1,.1,.1)),B=function e(){var t=this;Object(c.a)(this,e),this.overlayContainer=document.getElementById("overlay-container"),this.camera=new h.n(70,window.innerWidth/window.innerHeight,.01,100),this.scene=new h.r,this.renderer=new h.w({antialias:!0}),this.state=1,this.raycaster=new h.q,this.mouse=new h.u,this.lastHoverTarget=null,this.buttonCallback=function(){},this.boardGroup=new h.e,this.selectedBoard=[],this.selectPiecesGroup=new h.e,this.solveResult=[],this.solvePiecesGroup=new h.e,this.mouseDown=!1,this.controls=null,this.renderFrame=function(){if(1===t.state)t.selectBoard();else if(2===t.state){var e=0;t.boardGroup.children.forEach((function(t){t.material.opacity=Math.max(t.material.opacity-.025,0),t.material.opacity>e&&(e=t.material.opacity)})),0===e&&(t.state=3,t.camera.updateMatrixWorld(),S.forEach((function(e,n){var r=n%5,o=Math.floor(n/5),a=e.clone();a.translateX(.5*(-2+r)),a.translateY(.6-.65*o),a.translateZ(-.8),a.receiveShadow=!0,a.castShadow=!0,a.material.transparent=!0,a.pieceIndex=n,t.selectPiecesGroup.add(a);var i=document.createElement("input");i.type="number",i.value="0",i.min="0",t.overlayContainer.appendChild(i);var c=window.innerWidth/2,s=window.innerHeight/2,l=a.position.clone();l.y-=.2,l.project(t.camera),i.style.opacity="1",i.dataset.pieceIndex=n.toString(),i.style.left="".concat(Math.round(l.x*c+c),"px"),i.style.top="".concat(Math.round(-l.y*s+s),"px")})),t.scene.add(t.selectPiecesGroup)),t.scheduleFrame()}else if(3===t.state)t.selectPieces();else if(4===t.state){var n=0;if(document.querySelectorAll("input").forEach((function(e){var t=Number(e.style.opacity),r=Math.max(t-.025,0);e.style.opacity=r.toString(),n=Math.max(r,n)})),t.selectPiecesGroup.children.forEach((function(e,t){e.material.opacity=Math.max(e.material.opacity-.025,0),n=Math.max(e.material.opacity,n)})),0===n)t.scene.remove(t.selectPiecesGroup),Array.from(document.querySelectorAll("input")).forEach((function(e){var t;null===(t=e.parentElement)||void 0===t||t.removeChild(e)})),t.boardGroup.children.filter((function(e){return!(e instanceof h.f)||!t.selectedBoard[e.yIndex][e.xIndex]})).forEach((function(e){t.boardGroup.remove(e)})),t.boardGroup.translateZ(-.6),t.state=5;t.scheduleFrame()}else if(5===t.state){var r=0,o=1;t.solvePiecesGroup.children.forEach((function(e,t){var n=G(t);n.sub(e.position),n.clampLength(0,.01),n.length()>r&&(r=n.length()),e.position.add(n),e.rotateX(.005),e.rotateY(.0025)})),t.boardGroup.children.forEach((function(e){e.material.opacity=Math.min(e.material.opacity+.025,1),e.material.opacity<o&&(o=e.material.minOpacity)})),r<=.001&&1===o&&(t.controls=new w.a(t.camera,document.getElementsByTagName("body")[0]),t.controls.target=new h.v(0,0,-.6),t.state=6),t.scheduleFrame()}else if(6===t.state){var a;null===(a=t.controls)||void 0===a||a.update();var i=!1,c=0;t.solvePiecesGroup.children.forEach((function(e,n){if(i){e.rotation.x+=.005,e.rotation.y+=.0025;var r=G(n-c);r.sub(e.position),r.clampLength(0,.01),r.length()>1e-4&&e.position.add(r)}else{c+=1;var o=t.solveResult[n];if(0===e.userData.finalState){e.rotation.x+=.005,e.rotation.y+=.0025;var a=I(o);a.z+=.4,a.sub(e.position),a.clampLength(0,.01),a.length()>1e-4?(e.position.add(a),i=!0):e.userData.finalState=1}if(1===e.userData.finalState){var s=function(e){var t=new h.l;return e.forEach((function(e){"x"===e?t.rotateOnWorldAxis(new h.v(1,0,0),2*Math.PI*.25):"y"===e?t.rotateOnWorldAxis(new h.v(0,1,0),2*Math.PI*.25):t.rotateOnWorldAxis(new h.v(0,0,1),2*Math.PI*.25)})),t.rotation}(o.rotations).toVector3(),l=e.rotation.toVector3();s.sub(l),s.clampLength(0,.05),s.length()>1e-6?(l.add(s),e.rotation.setFromVector3(l),i=!0):e.userData.finalState=2}if(2===e.userData.finalState){var u=I(o);u.sub(e.position),u.clampLength(0,.01),u.length()>1e-4?(e.position.add(u),i=!0):e.userData.finalState=3}}})),i&&t.scheduleFrame()}t.renderer.render(t.scene,t.camera)},this.selectBoard=function(){t.setText("1/3: Piirr\xe4 pelilauta"),t.setButton("Jatka",(function(){t.setButton(null,(function(){})),t.state=2,t.selectedBoard=p()(t.boardGroup.children).filter((function(e){return e.isRayCastTarget})).groupBy((function(e){return e.position.y})).values().sortBy((function(e){return e[0].position.y})).map((function(e){return p.a.sortBy(e,(function(e){return e.position.x})).map((function(e){return.8===e.material.opacity}))})).value(),t.scheduleFrame()})),t.raycaster.setFromCamera(t.mouse,t.camera);var e=t.raycaster.intersectObjects(t.boardGroup.children);t.boardGroup.children.forEach((function(e){e.isRayCastTarget&&.25===e.material.opacity&&(e.material.opacity=0)})),t.lastHoverTarget=null;var n=!0,r=!1,o=void 0;try{for(var a,i=e[Symbol.iterator]();!(n=(a=i.next()).done);n=!0){var c=a.value.object;if(c.isRayCastTarget){.8!==c.material.opacity&&(c.material.opacity=.25),t.lastHoverTarget=c;break}}}catch(s){r=!0,o=s}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}},this.selectPieces=function(){t.setText("2/3: Valitse palat"),t.setButton("Ratkaise lauta",(function(){t.setButton(null,(function(){}));var e=p()(document.querySelectorAll("input")).flatMap((function(e){return p.a.times(parseInt(e.value,10),p.a.constant(parseInt(e.dataset.pieceIndex||"",10)))})).value(),n=p.a.flatten(t.selectedBoard.map((function(e){return e.map((function(e){return e?1:0}))})));console.log("-------flatboard"),console.log(n);var r=e.map((function(e){return function(e,t){var n=[];return e.forEach((function(e,t){e.forEach((function(e,r){for(var o=0;o<e;o++)n.push([r,t,o])}))})),console.log("-------"),console.log(e),console.log("---\x3e"),console.log(n),{blocks:n,originalIndex:t,rotations:[],dX:0,dY:0,dZ:0}}(m[e],e)}));if(2*n.filter((function(e){return e})).length===p()(r).map((function(e){return e.blocks})).flatten().value().length){var o=function(e,t,n,r){if(e*t!==n.length)throw new Error("invalid board/width/heigh");var o=performance.now(),a=2;function i(e,t,n){return Object(y.a)({},e,{blocks:e.blocks.map(n),originalIndex:e.originalIndex,rotations:e.rotations.concat(t)})}function c(e){return i(e,"x",(function(e){return[e[0],-e[2],e[1]]}))}function s(e){return i(e,"y",(function(e){return[e[2],e[1],-e[0]]}))}function l(e){return i(e,"z",(function(e){return[-e[1],e[0],e[2]]}))}function u(e){var t=Number.MAX_VALUE,n=Number.MAX_VALUE,r=Number.MAX_VALUE;e.blocks.forEach((function(e){e[0]<t&&(t=e[0]),e[1]<n&&(n=e[1]),e[2]<r&&(r=e[2])}));var o=Object(y.a)({},e,{blocks:e.blocks.map((function(e){return[e[0]-t,e[1]-n,e[2]-r]})),dX:e.dX-t,dY:e.dY-n,dZ:e.dZ-r});return o.blocks.sort((function(e,t){var n=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2];return 0!==n?n:0!==r?r:0!==o?o:0})),o}function d(e,t){for(var n=0;n<t.length;n++){for(var r=!0,o=0;o<t[n].blocks.length;o++){var a=e.blocks[o],i=t[n].blocks[o];r=r&&a[0]===i[0]&&a[1]===i[1]&&a[2]===i[2]}if(r)return}t.push(e)}n=n.concat(n);var h=function(e){for(var t=[],n=0;n<e.length;n++){for(var r=[],o=e[n],a=0;a<4;a++){for(var i=0;i<4;i++){for(var h=0;h<4;h++)d(u(o),r),o=s(o);o=l(o)}o=c(o)}t.push(r)}return t}(r);function f(r,o,i){return!(r<0||r>=e||o<0||o>=t||i<0||i>=a)&&1===n[i*e*t+o*e+r]}function m(r,o,i,c){if(r<0||r>=e||o<0||o>=t||i<0||i>=a)throw new Error("out of bounds! "+r+", "+o+", "+i);n[i*e*t+o*e+r]=+c}function v(e,t,n,r){for(var o=0;o<r.blocks.length;o++){var a=r.blocks[o];if(!f(a[0]+e,a[1]+t,a[2]+n))return!1}return!0}function w(e,t,n,r){r.blocks.forEach((function(r){m(r[0]+e,r[1]+t,r[2]+n,0)}))}function b(e,t,n,r){r.blocks.forEach((function(r){m(r[0]+e,r[1]+t,r[2]+n,1)}))}var g=[],x=function n(r){if(0===r.length)return console.log("Solved the board!"),p.a.cloneDeep(g);for(var o=0;o<e;o++)for(var i=0;i<t;i++)for(var c=0;c<a;c++)for(var s=0;s<r[0].length;s++){var l=r[0][s];if(v(o,i,c,l)){w(o,i,c,l),g.push([o+l.dX,i+l.dY,c+l.dZ,l]);var u=n(r.slice(1));if(g.pop(),b(o,i,c,l),u)return u}}return null}(h),E=null;return x&&(E=p.a.sortBy(x,(function(e){var t=e[2]-e[3].dZ;return p.a.sum(e[3].blocks.map((function(e){return t+e[2]})))/e[3].blocks.length})).map((function(e){return{x:e[0],y:e[1],z:e[2],rotations:e[3].rotations,originalIndex:e[3].originalIndex}}))),console.log("solver ran in "+(performance.now()-o)+"ms"),E}(5,5,n,r);o?(console.log(o),o.forEach((function(e,n){var r=t.selectPiecesGroup.children.find((function(t){return t.pieceIndex===e.originalIndex})).clone();r.material=r.material.clone(),r.material.color.setHex(v[n%v.length]),r.userData.finalState=0,t.solvePiecesGroup.add(r)})),t.scene.add(t.solvePiecesGroup),t.solveResult=o,t.state=4,t.setText(""),t.scheduleFrame()):alert("unable to solve, please check the pieces")}else alert("Please select correct pieces or confirm that the board is correct")})),t.selectPiecesGroup.children.forEach((function(e){e.lookAt(e.position.x-t.mouse.x,e.position.y-t.mouse.y,1),e.rotation.z=0}))},this.hasScheduled=!1,this.scheduleFrame=function(){t.hasScheduled||(t.hasScheduled=!0,requestAnimationFrame(t.scheduled))},this.scheduled=function(){t.hasScheduled=!1,t.renderFrame()},this.lastText=null,this.setText=function(e){e!==t.lastText&&(t.lastText=e,document.getElementById("text-container").innerText=e)},this.setButton=function(e,n){var r=document.getElementById("button");e?(r.innerText=e,r.style.visibility="visible",t.buttonCallback=n):r.style.visibility="hidden"},this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=h.m,this.camera.position.z=1,this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),document.getElementById("button").addEventListener("click",(function(){t.buttonCallback()})),document.addEventListener("mousedown",(function(){t.mouseDown=!0})),document.addEventListener("mouseup",(function(){t.mouseDown=!1})),window.document.addEventListener("mousemove",(function(e){t.mouse.x=e.clientX/window.innerWidth*2-1,t.mouse.y=-e.clientY/window.innerHeight*2+1,6===t.state&&t.mouseDown,t.scheduleFrame()})),window.document.addEventListener("click",(function(){var e=t.lastHoverTarget;e&&(e.material.opacity=.8===e.material.opacity?.25:.8,t.scheduleFrame())}));for(var n=0;n<5;n+=1)for(var r=0;r<5;r+=1){var o=.1*n-.2,a=.1*r-.2,i=new h.f(E.clone(),x.clone());i.position.x=o,i.position.y=a,i.xIndex=n,i.yIndex=r,i.material.transparent=!0,this.boardGroup.add(i);var s=new h.i(k,g.clone());s.position.x=o+.05,s.position.y=a+.05,s.material.opacity=0,s.material.transparent=!0,s.isRayCastTarget=!0,this.boardGroup.add(s)}this.scene.add(this.boardGroup);var l=new h.o(16777215,1,0,1);l.position.set(0,0,.3),l.castShadow=!0,l.shadow.mapSize.width=1024,l.shadow.mapSize.height=1024,l.shadow.bias=1e-11,l.shadow.camera.near=.01,l.shadow.radius=3,this.scene.add(l);var u=new h.a;u.intensity=.5,this.scene.add(u),this.renderFrame()};function G(e){return new h.v(-1,-.6*e,-.4)}function I(e){return new h.v(.1*e.x-.15,.1*e.y-.15,.1*e.z+.05-.6)}var M=b;i.a.render(o.a.createElement(M,null),document.getElementById("root"))}},[[14,1,2]]]);
//# sourceMappingURL=main.ff336fcc.chunk.js.map